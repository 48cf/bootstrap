#! /bin/sh

name=menix
from_source=menix
imagedeps="build-essential rustup"
allow_network=yes

build() {
    cargo_build \
        --target=toolchain/${ARCH}-kernel.json \
        --release
}

package() {
    mkdir -p "${dest_dir}${prefix}/share/menix/"
    mkdir -p "${dest_dir}${prefix}/lib/modules/"

    install -m644 target/${ARCH}-kernel/release/menix.kso "${dest_dir}${prefix}/share/menix/menix"
    install -m644 target/${ARCH}-kernel/release/*.kso "${dest_dir}${prefix}/lib/modules/"

    rm "${dest_dir}${prefix}/lib/modules/menix.kso"
}
