sources:
- name: menix
  subdir: sources
  git: 'https://github.com/menix-os/menix.git'
  branch: main
  submodules: true
  rolling_version: true
  version: '0.0pl@ROLLING_ID@'

packages:
- name: menix
  labels: [ x86_64 ]
  architecture: '@OPTION:arch@'
  from_source: menix
  tools_required:
  - host-gcc
  - host-cmake
  pkgs_required:
  - mlibc
  configure:
  - args:
    - 'cmake'
    - '-S@THIS_SOURCE_DIR@'
    - '-DMENIX_ARCH=@OPTION:arch@'
    - '-DCMAKE_C_COMPILER=@OPTION:arch@-@OPTION:triple@-gcc'
    - '-DCMAKE_BUILD_TYPE=Release'
    - '-GNinja'
  build:
  - args:
    - 'ninja'
  - args: [ 'mkdir', '-p', '@THIS_COLLECT_DIR@/boot' ]
  - args: [ 'cp', '-r', '@THIS_BUILD_DIR@/bin/menix', '@THIS_COLLECT_DIR@/boot/menix' ]
  # TODO: Build CPIO archive for drivers

- name: menix-debug
  labels: [ x86_64 ]
  architecture: '@OPTION:arch@'
  from_source: menix
  tools_required:
  - host-gcc
  - host-cmake
  pkgs_required:
  - mlibc
  configure:
  - args:
    - 'cmake'
    - '-S@THIS_SOURCE_DIR@'
    - '-DMENIX_ARCH=@OPTION:arch@'
    - '-DCMAKE_C_COMPILER=@OPTION:arch@-@OPTION:triple@-gcc'
    - '-DCMAKE_BUILD_TYPE=RelWithDebInfo'
    - '-GNinja'
  build:
  - args:
    - 'ninja'
  - args: [ 'mkdir', '-p', '@THIS_COLLECT_DIR@/boot' ]
  - args: [ 'cp', '-r', '@THIS_BUILD_DIR@/bin/menix', '@THIS_COLLECT_DIR@/boot/menix-debug' ]
